# Put here configuration related to environment and tools
# For a complete list of options, see:
# https://pyflow-wellies.readthedocs.io/latest/config/tools_config/#tool-types
ecflow_variables:
  MODULES_VERSION: "new"

tools:
# ---------- System modules ---------------------------------------------------
  modules:
    python:
      name: python3
      version: 3.10.10-01
    uv:
      name: uv
      version: 0.6.14

# ---------- Anemoi packages ---------------------------------------------------
  packages:
    anemoi_datasets:
      type: git
      source: https://github.com/ecmwf/anemoi-datasets.git
      branch: "{anemoi_datasets_branch}"
      depends: [uv, UV_CACHE_DIR, anemoi_utils, anemoi_transform]
      post_script: "git fetch --unshallow --tags && uv pip install --upgrade pip && uv pip install -e ."
    anemoi_core:
      type: git
      source: https://github.com/ecmwf/anemoi-core.git
      branch: "{anemoi_core_branch}"
      depends: [uv, UV_CACHE_DIR, anemoi_utils, anemoi_transform, anemoi_datasets]
      post_script: "git fetch --unshallow --tags && uv pip install --upgrade pip && uv pip install -e ./training[all,tests] -e ./graphs[all,tests] -e ./models[all,tests]"
    anemoi_transform:
      type: git
      source: https://github.com/ecmwf/anemoi-transform.git
      branch: "{anemoi_transform_branch}"
      depends: [uv, UV_CACHE_DIR, anemoi_utils]
      post_script: "git fetch --unshallow --tags && uv pip install --upgrade pip && uv pip install -e ."
    anemoi_utils:
      type: git
      source: https://github.com/ecmwf/anemoi-utils.git
      branch: "{anemoi_utils_branch}"
      depends: [uv, UV_CACHE_DIR]
      post_script: "git fetch --unshallow --tags && uv pip install --upgrade pip && uv pip install -e ."

  # --------Virtual envs --------------------------------------------------
  environments:
      datasets_env:
        type: venv
        packages: [anemoi_datasets, anemoi_utils, anemoi_transform]
        depends: [python]
      training_env:
        type: venv
        packages: [anemoi_core, anemoi_utils, anemoi_transform, anemoi_datasets]
        depends: [python]

  # --------Environment variables -----------------------------------------

  env_variables:
    UV_CACHE_DIR:
      value: "{OUTPUT_ROOT_SUITE}/uv_cache"
